<!--<!DOCTYPE html>-->
<html lang="ja">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>圧力の計算</title>
  <meta name="apple-mobile-web-app-capable" content="yes"> 
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=BIZ+UDGothic:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
  
<body>
  <header class="game-header">
    <div class="user-info">
      
        <p><spen id="user-name-display">username</spen></p>
        <button id="change-name-btn">名前を変更</button>
      
      <p></p>
      <p>解いた問題数: <spen id="solved-count">10</spen> 問</p>
     
    </div>
      
    <a href="#" class="achievements-link">実績一覧</a>
    
  </header>

  <main class="selection-container">
    <p class="selection-title">圧力の計算 問題選択</p>
    
    <p class="level-title">レベル</p>
    <div class="level-selection" id="level-selection">
      
      <button class="level-button active" data-level="1">
        レベル1
        <br>
        <spen class="mini-text">
          Paを求める
        </spen>
      </button>
      
      <button class="level-button" data-level="2">
        レベル2
        <br>
        <spen class="mini-text">
          N,㎡,Paを求める
        </spen>
      </button>
      
      <button class="level-button" data-level="3">
        レベル3
        <br>
        <spen class="mini-text">
          単位の換算が必要
        </spen>
      </button>
      
      <!--<button class="questions-button" data-mode="time-attack">30問</button>-->
      
    </div>
    
    <p class="questions-title">問題数</p>
    <div class="questions-selection" id="questions-selection">
      
      <button class="questions-button active" data-questions="5">5問</button>
      
      <button class="questions-button" data-questions="10">10問</button>
      
      <button class="questions-button" data-questions="20">20問</button>
      
      <button class="questions-button" data-questions="30">30問</button>
      
    </div>
    
    <span class="split-line"></span>
    
    <div class="mode-selection">
      <button class="mode-button" id="timeAttackButton">
        タイムアタック
        <spen class="mini-text">
          でスタート
        </spen>
      </button>
      
      <button class="mode-button" id="practiceButton">
        練習
        <spen class="mini-text">
          でスタート
        </spen>
      </button>
      
      
    </div>
    
  </main>
  
  
  
  
  
  
  
  <script>
    const usernameDisplay = document.getElementById('user-name-display');
    const changeNameBtn = document.getElementById('change-name-btn');

// ページの読み込み時に実行する関数
    function initializeUsername() {
  // ローカルストレージからユーザーネームを取得
      const savedName = localStorage.getItem('username');

  // 名前が保存されていない場合
      if (!savedName) {
        promptForName(true); // 名前設定ダイアログを表示
      } else {
        updateUsernameDisplay(savedName); // ヘッダーに名前を表示
      }
    }
    
    function promptForName(first) {
  let newName = ''; // 変数をループ外で定義

  // ユーザーが有効な名前を入力するまでループ
  while (true) {
    if (first == true) {
      newName = prompt('はじめまして！名前を入力してください（10文字以内）');
    } else {
      newName = prompt('名前を入力してください（10文字以内）');
    }
    // キャンセルボタンが押された場合
    if (newName === null) {
      return; // 処理を中断
    }

    // 文字数チェック
    if (newName.trim().length > 10) {
      alert('名前は10文字以内で入力してください。');
      // ループが続くので、再度promptが表示される
    } else if (newName.trim() === '') {
      alert('名前が入力されていません。');
      // ループが続く
    } else {
      // 有効な名前が入力されたのでループを抜ける
      break; 
    }
  }

  // ループを抜けた後、名前を保存・表示
  saveUsername(newName.trim());
  updateUsernameDisplay(newName.trim());
}

    // ユーザーネームをローカルストレージに保存する関数
    function saveUsername(name) {
      localStorage.setItem('username', name);
      
    }

    // ユーザーネーム表示を更新する関数
    function updateUsernameDisplay(name) {
      usernameDisplay.textContent = name;
    }

    // イベントリスナーを設定
    // ページが完全に読み込まれた後に実行
    document.addEventListener('DOMContentLoaded', initializeUsername);

// 名前変更ボタンがクリックされたときに実行
    changeNameBtn.addEventListener('click', promptForName);
  
    
    const  levelButtons = document.querySelectorAll('.level-button');
    const questionsButtons = document.querySelectorAll('.questions-button');

    let selectedLevel = null;
    let selectedQuestions = null;

        // level選択ボタンのイベントリスナー
    levelButtons.forEach(button => {
        button.addEventListener('click', () => {
            // 選択状態をリセット
            levelButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            localStorage.setItem('setLevel', button.dataset.level);
            //selectedLevel = button.dataset.level;
            //checkSelection();
        });
    });

    // 問題数選択ボタンのイベントリスナー
    questionsButtons.forEach(button => {
        button.addEventListener('click', () => {
            // 選択状態をリセット
            questionsButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            localStorage.setItem('setQuestions', button.dataset.questions);
            //selectedQuestions = button.dataset.questions;
            //checkSelection();
        });
    });
    
   document.getElementById('timeAttackButton').addEventListener('click', () => {
            const params = new URLSearchParams();
            
            // 問題数の設定ボタンからactiveなものを探す
            const levelButton = document.querySelector('#level-selection .level-button.active');
            if (levelButton) {
                params.append('level', levelButton.dataset.level);
            }

            // レベルの設定ボタンからactiveなものを探す
            const questinsButton = document.querySelector('#questions-selection .questions-button.active');
            if (questionsButton) {
                params.append('questions',questionsButton.dataset.questions);
            }

            // 表示画面に遷移（クエリパラメータを付与）
            window.location.href = `timeattack.html?${params.toString()}`;
    });
    
  </script>
</body>
  
</html>
